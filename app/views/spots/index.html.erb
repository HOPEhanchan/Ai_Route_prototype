<div class="min-h-[60vh] bg-slate-50">
  <div class="max-w-3xl mx-auto px-4 py-8 space-y-4">

    <!-- タイトル行 -->
    <div class="flex justify-between items-center gap-3">
      <div>
        <h1 class="text-xl font-bold text-emerald-600">
          あなたの行きたいスポット
        </h1>
        <p class="mt-1 text-xs sm:text-sm text-gray-600">
          気になったお店やスポットをストックして、<br>
          あとで行き先リストにまとめていけるようにします。
        </p>
      </div>

      <div class="shrink-0">
        <%= link_to "+ 追加",
                    new_spot_path,
                    class: "inline-flex items-center px-3 py-2 rounded-lg text-xs sm:text-sm
                            bg-emerald-500 text-white font-medium hover:bg-emerald-600" %>
      </div>
    </div>

    <!-- 🔽 リストで絞り込みドロップダウン -->
    <div class="mt-2 text-xs sm:text-sm">
      <div class="flex items-center gap-2">
        <span class="text-[11px] sm:text-xs text-slate-500 whitespace-nowrap">
          リストで絞り込み
        </span>

        <%= form_with url: spots_path, method: :get, local: true, class: "flex-1" do |f| %>
          <%= f.select :list_id,
                options_for_select(
                  [["すべて", ""]] + @lists.map { |list| [list.name, list.id] },
                  (@current_list&.id&.to_s || "")
                ),
                {},
                class: "w-full rounded-full border border-slate-300 bg-white px-3 py-1.5
                        text-xs sm:text-sm min-w-[140px]",
                onchange: "this.form.submit()" %>
        <% end %>
      </div>
    </div>

    <!-- 🔽 タグで絞り込み機能 -->
    <% if @tags.any? %>
      <div class="mt-3 space-y-2">
        <!-- 見出し + 注釈（PC/スマホ共通でここに置く） -->
        <div>
          <p class="text-[11px] sm:text-xs text-slate-500">
            タグで絞り込み （※１つのみ）
          </p>
          <p class="text-[10px] text-slate-400">
            横にスクロールすると他の登録タグが見れます 👉
          </p>
        </div>

        <div class="flex-1 overflow-x-auto">
          <!-- 横並びタグチップ（横スクロール） -->
          <div class="inline-flex gap-2 pb-1">
            <!-- 「すべて」ボタン -->
            <% active_all = params[:tag].blank? %>
            <%= link_to spots_path(list_id: params[:list_id]),
                        class: [
                          "inline-flex items-center px-3 py-1 rounded-full border text-[11px] sm:text-xs whitespace-nowrap",
                          (active_all ?
                            "bg-emerald-500 text-white border-emerald-500" :
                            "bg-white text-slate-600 border-slate-300 hover:bg-slate-50")
                        ].join(" ") do %>
              すべて
            <% end %>

            <!-- 各タグチップ -->
            <% @tags.each do |tag| %>
              <% active = params[:tag] == tag.name %>
              <%= link_to spots_path(list_id: params[:list_id], tag: tag.name),
                          class: [
                            "inline-flex items-center px-3 py-1 rounded-full border text-[11px] sm:text-xs whitespace-nowrap",
                            (active ?
                              "bg-emerald-500 text-white border-emerald-500" :
                              "bg-white text-slate-600 border-slate-300 hover:bg-slate-50")
                          ].join(" ") do %>
                <span><%= tag.name %></span>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>

    <!-- 🔽 スポットカード一覧 -->
    <% if @spots.any? %>
      <div class="space-y-3">
        <% @spots.each do |spot| %>
          <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-4">
            <!-- 上段：タイトル＋URL -->
            <div class="flex justify-between items-start gap-3">
              <div class="space-y-1">
                <h2 class="font-semibold text-gray-800 text-sm sm:text-base">
                  <span class="block max-w-[220px] truncate sm:max-w-none sm:whitespace-normal">
                    <%= spot.title.presence || "（タイトル未入力）" %>
                  </span>
                </h2>

                <% if spot.url.present? %>
                  <a href="<%= spot.url %>"
                     target="_blank" rel="noopener"
                     class="inline-flex items-center text-xs text-emerald-600 hover:text-emerald-700 break-all">
                     <span class="truncate max-w-[220px] sm:max-w-xs">
                       <%= spot.url %>
                     </span>
                  </a>
                <% end %>
              </div>
            </div>

            <% if spot.image_url.present? %>
              <div class="mt-3">
                <%= image_tag spot.image_url,
                      class: "w-full max-h-48 object-cover rounded-lg border border-slate-200" %>
              </div>
            <% end %>

            <!-- 中段：ひとことメモ -->
            <div class="mt-3 pt-3 border-t border-slate-100 space-y-1">
              <p class="text-xs font-medium text-slate-500">
                ひとことメモ
              </p>
              <p class="text-sm text-slate-700 whitespace-pre-line">
                <%= spot.memo.presence || "まだメモがありません。" %>
              </p>
            </div>

            <!-- tagの表示 -->
            <% if spot.tags.exists? %>
              <div class="mt-2 flex flex-wrap gap-1">
                <% spot.tags.each do |tag| %>
                  <%= link_to spots_path(tag: tag.name, list_id: @current_list&.id),
                              class: [
                                "inline-flex items-center px-2 py-0.5 rounded-full text-[11px] border transition",
                                (@selected_tag&.id == tag.id ?
                                  "bg-emerald-600 text-white border-emerald-600" :
                                  "bg-emerald-50 text-emerald-700 border-emerald-100 hover:bg-emerald-100 hover:border-emerald-200"
                                )
                              ].join(" ") do %>
                    <span>#<%= tag.name %></span>
                  <% end %>
                <% end %>
              </div>
            <% end %>

            <!-- 下段：フッター -->
            <div class="mt-3 flex justify-between items-center text-[11px] sm:text-xs">
              <div class="text-gray-400 whitespace-nowrap">
                作成日: <%= l spot.created_at.to_date %>
              </div>

              <div class="flex gap-2 text-[11px] sm:text-xs">
                <!-- 詳細：リストの「開く」と同じニュートラルボタン -->
                <%= link_to spot_path(spot),
                            class: "inline-flex items-center gap-1 px-3 py-1 rounded-lg
                                    border border-slate-300 bg-white text-slate-700
                                    hover:bg-slate-100 hover:text-slate-900 transition" do %>
                  <span>詳細</span>
                <% end %>

                <!-- 編集：エメラルド系ボタン -->
                <%= link_to edit_spot_path(spot),
                            class: "inline-flex items-center gap-1 px-3 py-1 rounded-lg
                                    border border-emerald-200 bg-emerald-50 text-emerald-700
                                    hover:bg-emerald-100 transition" do %>
                  <span>編集</span>
                <% end %>

                <!-- 削除：赤ボタン -->
                <%= button_to spot_path(spot),
                              method: :delete,
                              data: { turbo_confirm: "このスポットを削除しますか？" },
                              class: "inline-flex items-center gap-1 px-3 py-1 rounded-lg
                                      border border-red-200 bg-red-50 text-red-700
                                      hover:bg-red-100 transition" do %>
                  <span>削除</span>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="mt-6 rounded-xl border border-dashed border-slate-300 bg-white p-5 text-center">
        <p class="text-sm text-gray-600">
          「行きたいスポット」が登録されていません。
        </p>
        <p class="mt-1 text-xs text-gray-500">
          気になるお店やスポットのURLを見つけたら、<br>
          右上の <span class="font-semibold">「＋ 追加」</span> から登録しておきましょう。
        </p>
      </div>
    <% end %>
  </div>
</div>
