<nav class="bg-white border-b border-gray-200">
  <div class="max-w-4xl mx-auto px-4 py-3 flex items-center justify-between gap-3">

    <!-- 左：ロゴ -->
    <div class="min-w-0">
      <%= link_to (user_signed_in? ? lists_path : root_path),
                  class: "inline-flex flex-col sm:flex-row sm:items-baseline gap-0.5 sm:gap-2 no-underline" do %>

        <span class="text-lg sm:text-xl font-bold text-emerald-500 whitespace-nowrap leading-tight">
          <%= t("header.title") %>
        </span>

        <span class="hidden sm:block text-[11px] text-gray-500 sm:mt-0.5 leading-snug truncate">
          <%= t("header.tagline") %>
        </span>
      <% end %>
    </div>

    <!-- 右：ナビ -->
    <% if user_signed_in? %>
      <div class="flex items-center gap-2">

        <!-- PC：listとspotはあえてヘッダーに出す -->
        <div class="hidden sm:flex items-center gap-1">
          <%= link_to lists_path,
                class: "px-3 py-1.5 rounded-md text-sm text-emerald-700 hover:bg-emerald-50 whitespace-nowrap" do %>
            [📝リスト追加] <span class="hidden md:inline">リスト</span>
          <% end %>

          <%= link_to spots_path,
                class: "px-3 py-1.5 rounded-md text-sm text-emerald-700 hover:bg-emerald-50 whitespace-nowrap" do %>
            [📍スポット追加] <span class="hidden md:inline">スポット</span>
          <% end %>
        </div>

        <!-- 右上メニュー（PC/スマホ共通の見た目） -->
        <details class="relative">
          <summary class="list-none cursor-pointer flex items-center gap-2 select-none">
            <% if current_user.avatar_url.present? %>
              <img src="<%= current_user.avatar_url %>"
                   alt="avatar"
                   class="w-8 h-8 rounded-full object-cover border border-slate-300" />
            <% else %>
              <div class="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-white text-sm">
                <%= current_user.email.first.upcase %>
              </div>
            <% end %>

            <span class="text-[11px] text-slate-500 hidden sm:inline">
              メニュー
            </span>
            <span class="text-[10px] text-slate-400 hidden sm:inline">
              ▼
            </span>
          </summary>

          <div class="absolute right-0 mt-2 w-44 bg-white/95 backdrop-blur
                      rounded-xl shadow-lg border border-emerald-100 py-2 z-30">

            <p class="px-3 pb-2 text-[11px] text-slate-400 truncate">
              <%= current_user.email %>
            </p>

            <!-- Admin -->
            <% if current_user.admin? %>
              <%= link_to admin_contact_messages_path,
                    class: "block px-3 py-2 text-sm hover:bg-amber-50 text-amber-700 font-semibold" do %>
                🛠 Admin
              <% end %>
              <div class="my-1 border-t border-slate-100"></div>
            <% end %>

            <!-- スマホ：listとスポットもメニューに含める -->
            <div class="sm:hidden">
              <%= link_to lists_path, class: "block px-3 py-2 text-sm hover:bg-slate-50" do %>
                📝 リスト
              <% end %>
              <%= link_to spots_path, class: "block px-3 py-2 text-sm hover:bg-slate-50" do %>
                📍 スポット
              <% end %>
              <div class="my-1 border-t border-slate-100"></div>
            </div>

            <%= link_to profile_path, class: "block px-3 py-2 text-sm hover:bg-slate-50" do %>
              👤 プロフィール
            <% end %>

            <%= link_to "AiRouteとは？", about_path, class: "block px-3 py-2 text-sm hover:bg-slate-50" %>
            <%= link_to "利用規約", terms_path, class: "block px-3 py-2 text-sm hover:bg-slate-50" %>
            <%= link_to "プライバシーポリシー", privacy_path, class: "block px-3 py-2 text-sm hover:bg-slate-50" %>
            <%= link_to "お問い合わせ", new_contact_messages_path, class: "block px-3 py-2 text-sm hover:bg-slate-50" %>

            <div class="mt-2 pt-2 border-t border-slate-100">
              <%= button_to "ログアウト",
                    destroy_user_session_path,
                    method: :delete,
                    data: { turbo_confirm: t("header.nav.logout_confirm") },
                    class: "w-full text-left px-3 py-2 text-sm text-red-600 hover:bg-red-50" %>
            </div>
          </div>
        </details>
      </div>

    <% else %>
      <!-- 未ログイン -->
      <div class="flex items-center gap-3 text-xs sm:text-sm whitespace-nowrap">
        <%= link_to t("header.nav.login"),
              new_user_session_path,
              class: "text-gray-700 hover:text-emerald-600" %>

        <%= link_to t("header.nav.signup"),
              new_user_registration_path,
              class: "px-3 py-1.5 rounded-md bg-emerald-500 text-white hover:bg-emerald-600" %>
      </div>
    <% end %>

  </div>
</nav>
